<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Pokémon Collection</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Styles -->
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- Header -->
  <header class="site-header">
    <img src="pokemon-logo.png" alt="Pokémon Logo" class="logo">

    <nav>
      <a href="index.html">Search</a>
      <a href="collection.html">My Collection</a>
    </nav>
  </header>

  <!-- Main Content -->
  <main>
    <!-- Collection Controls -->
    <section class="search" style="align-items:center;">
      <h2 style="color:#ffcb05;">My Collection</h2>

      <select id="sortSelect" style="padding:10px;border-radius:8px;">
        <option value="default">Sort by</option>
        <option value="name">Name (A–Z)</option>
        <option value="priceAsc">Price (Low → High)</option>
        <option value="priceDesc">Price (High → Low)</option>
      </select>

      <p id="totalValue" style="font-weight:700;"></p>
    </section>

    <!-- Collection Grid -->
    <section>
      <div id="collection" class="grid"></div>
    </section>
  </main>

  <!-- Script -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const collectionDiv = document.getElementById("collection");
      const totalValueEl = document.getElementById("totalValue");
      const sortSelect = document.getElementById("sortSelect");

      let collection =
        JSON.parse(localStorage.getItem("collection")) || [];

      if (collection.length === 0) {
        collectionDiv.innerHTML =
          "<p>Your collection is empty.</p>";
        totalValueEl.textContent = "";
        return;
      }

      renderCollection(collection);

      sortSelect.addEventListener("change", () => {
        let sorted = [...collection];

        if (sortSelect.value === "name") {
          sorted.sort((a, b) =>
            (a.name || "").localeCompare(b.name || "")
          );
        }

        if (sortSelect.value === "priceAsc") {
          sorted.sort((a, b) =>
            getPrice(a) - getPrice(b)
          );
        }

        if (sortSelect.value === "priceDesc") {
          sorted.sort((a, b) =>
            getPrice(b) - getPrice(a)
          );
        }

        renderCollection(sorted);
      });

      function renderCollection(cards) {
        collectionDiv.innerHTML = "";
        let totalValue = 0;

        cards.forEach((card) => {
          const image = card.images?.small || "";
          const name = card.name || "Unknown Card";
          const setName = card.set?.name || "Unknown Set";
          const number = card.number ? `#${card.number}` : "";
          const price = getPrice(card);

          totalValue += price;

          const cardDiv = document.createElement("div");
          cardDiv.className = "card";

          cardDiv.innerHTML = `
            ${image ? `<img src="${image}" alt="${name}">` : ""}
            <h3>${name}</h3>
            <p class="details">${setName} ${number}</p>
            <p class="price">
              ${price > 0 ? `$${price.toFixed(2)}` : "Price not available"}
            </p>
            <button>Remove</button>
          `;

          cardDiv.querySelector("button").addEventListener("click", () => {
            removeCard(card.id);
          });

          collectionDiv.appendChild(cardDiv);
        });

        totalValueEl.textContent =
          `Total Collection Value: $${totalValue.toFixed(2)}`;
      }

      function getPrice(card) {
        return (
          card.tcgplayer?.prices?.holofoil?.market ??
          card.tcgplayer?.prices?.normal?.market ??
          0
        );
      }

      function removeCard(cardId) {
        collection = collection.filter(c => c.id !== cardId);
        localStorage.setItem(
          "collection",
          JSON.stringify(collection)
        );
        renderCollection(collection);
      }
    });
  </script>

</body>
</html>
