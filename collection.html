<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Pokémon Collection</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<header class="site-header">
  <img src="pokemon-logo.png" class="logo" alt="Pokémon Logo">
  <nav>
    <a href="index.html">Search</a>
    <a href="collection.html">My Collection</a>
  </nav>
</header>

<main>

  <!-- Controls -->
  <section class="controls">
    <h2>My Collection</h2>

    <input id="searchInput" placeholder="Search cards...">

    <select id="rarityFilter">
      <option value="all">All Rarities</option>
      <option value="Common">Common</option>
      <option value="Uncommon">Uncommon</option>
      <option value="Rare">Rare</option>
      <option value="Ultra Rare">Ultra Rare</option>
    </select>

    <select id="sortSelect">
      <option value="default">Sort by</option>
      <option value="name">Name (A–Z)</option>
      <option value="priceAsc">Price (Low → High)</option>
      <option value="priceDesc">Price (High → Low)</option>
    </select>
  </section>

  <!-- Stats -->
  <section class="stats">
    <p id="statCount"></p>
    <p id="statTotal"></p>
    <p id="statAvg"></p>
    <p id="statTop"></p>
  </section>

  <!-- Grid -->
  <section>
    <div id="grid" class="grid"></div>
  </section>

</main>

<script>
const grid = document.getElementById("grid");
const searchInput = document.getElementById("searchInput");
const rarityFilter = document.getElementById("rarityFilter");
const sortSelect = document.getElementById("sortSelect");

const statCount = document.getElementById("statCount");
const statTotal = document.getElementById("statTotal");
const statAvg = document.getElementById("statAvg");
const statTop = document.getElementById("statTop");

let collection = JSON.parse(localStorage.getItem("collection")) || [];

searchInput.oninput =
rarityFilter.onchange =
sortSelect.onchange = render;

function price(card) {
  return (
    card.tcgplayer?.prices?.holofoil?.market ??
    card.tcgplayer?.prices?.normal?.market ??
    0
  );
}

function render() {
  grid.innerHTML = "";

  let filtered = collection.filter(c => {
    const text = searchInput.value.toLowerCase();
    const matchesText =
      (c.name || "").toLowerCase().includes(text) ||
      (c.set?.name || "").toLowerCase().includes(text);

    const matchesRarity =
      rarityFilter.value === "all" ||
      c.rarity === rarityFilter.value;

    return matchesText && matchesRarity;
  });

  if (sortSelect.value === "name")
    filtered.sort((a,b)=>a.name.localeCompare(b.name));
  if (sortSelect.value === "priceAsc")
    filtered.sort((a,b)=>price(a)-price(b));
  if (sortSelect.value === "priceDesc")
    filtered.sort((a,b)=>price(b)-price(a));

  updateStats(filtered);

  if (!filtered.length) {
    grid.innerHTML = "<p>No cards found.</p>";
    return;
  }

  filtered.forEach(card => {
    const el = document.createElement("div");
    el.className =
